<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°°ì°¨ ì˜¤ë” ë¶„ì„ ì‹œìŠ¤í…œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #0066cc 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .logo {
            background: #1e3c72;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            margin-right: 25px;
            font-weight: bold;
            font-size: 18px;
            text-align: center;
            min-width: 200px;
        }
        
        .logo .company-name { font-size: 24px; margin-bottom: 5px; letter-spacing: 2px; }
        .logo .tagline { font-size: 12px; opacity: 0.9; font-weight: normal; }
        
        h1 { color: #1e3c72; margin: 0; font-size: 2.2em; }
        
        .tabs {
            display: flex;
            background: rgba(255,255,255,0.15);
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .tab {
            flex: 1;
            padding: 18px 25px;
            text-align: center;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #0066cc 0%, #1e3c72 100%);
            box-shadow: 0 4px 15px rgba(0, 102, 204, 0.3);
        }
        
        .tab:hover { background: rgba(255,255,255,0.2); }
        
        .tab-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .tab-content.active { display: block; }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .form-group { display: flex; flex-direction: column; }
        
        label { font-weight: bold; margin-bottom: 8px; color: #555; }
        
        input, select, textarea {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #0066cc 0%, #1e3c72 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn:hover { transform: translateY(-2px); }
        
        .stats-grid {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #0066cc 0%, #1e3c72 100%);
            padding: 20px;
            border-radius: 15px;
            color: white;
            text-align: center;
            flex: 1;
            min-width: 180px;
            min-height: 110px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .stat-card h3 { font-size: 2.2em; margin-bottom: 8px; }
        .stat-card p { font-size: 1em; opacity: 0.9; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }
        
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: linear-gradient(135deg, #1e3c72 0%, #0066cc 100%); color: white; }
        tr:hover { background-color: #f8f9ff; }
        
        .delete-btn, .edit-btn, .save-btn, .cancel-btn {
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 5px;
        }
        
        .delete-btn { background: #ff4757; color: white; }
        .edit-btn { background: #28a745; color: white; }
        .save-btn { background: #007bff; color: white; }
        .cancel-btn { background: #6c757d; color: white; }
        
        .edit-input { padding: 5px; border: 1px solid #ddd; border-radius: 3px; width: 80px; font-size: 12px; }
        .edit-input-wide { width: 100px; }
        .edit-select { padding: 5px; border: 1px solid #ddd; border-radius: 3px; width: 120px; font-size: 12px; }
        .edit-input-memo { width: 200px; height: 60px; padding: 5px; border: 1px solid #ddd; border-radius: 3px; font-size: 12px; }
        
        .filter-section {
            background: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group { display: flex; align-items: center; gap: 10px; }
        .filter-group label { font-weight: bold; margin: 0; white-space: nowrap; }
        .filter-group select, .filter-group input { padding: 8px; border-radius: 5px; border: 1px solid #ddd; min-width: 150px; }
        
        .export-section {
            text-align: center;
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #0066cc 0%, #1e3c72 100%);
            border-radius: 15px;
            color: white;
        }
        
        .export-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        
        .status-message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="company-name">TAEYOUNGWIN</div>
                <div class="tagline">ë‚´ì¼ì˜ í¬ë§ì´ ì˜¤ëŠ˜ì„ ë§Œë“  (ì£¼)íƒœì˜ìœˆ</div>
            </div>
            <h1>ğŸšš ë°°ì°¨ ì˜¤ë” ë¶„ì„ ì‹œìŠ¤í…œ</h1>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('input')">ğŸ“ ë°ì´í„° ì…ë ¥</button>
            <button class="tab" onclick="showTab('analysis')">ğŸ“Š í†µê³„ ë¶„ì„</button>
            <button class="tab" onclick="showTab('history')">ğŸ“‹ ì´ë ¥ ê´€ë¦¬</button>
        </div>
        
        <div id="input" class="tab-content active">
            <h2 style="margin-bottom: 25px; color: #1e3c72;">ì¼ì¼ ë°°ì°¨ ì˜¤ë” ì…ë ¥</h2>
            <div id="statusMessage"></div>
            
            <form id="orderForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="date">ë‚ ì§œ</label>
                        <input type="date" id="date" required>
                    </div>
                    <div class="form-group">
                        <label for="branch">ì§€ì‚¬ëª…</label>
                        <select id="branch" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì²­ì£¼ì§€ì‚¬">ì²­ì£¼ì§€ì‚¬</option>
                            <option value="ì¶©ì£¼ì§€ì‚¬">ì¶©ì£¼ì§€ì‚¬</option>
                            <option value="ì²œì•ˆì§€ì‚¬">ì²œì•ˆì§€ì‚¬</option>
                            <option value="ì•„ì‚°ì§€ì‚¬">ì•„ì‚°ì§€ì‚¬</option>
                            <option value="ì„œì‚°ì§€ì‚¬">ì„œì‚°ì§€ì‚¬</option>
                            <option value="ì„¸ì¢…ì§€ì‚¬">ì„¸ì¢…ì§€ì‚¬</option>
                            <option value="ë‚¨ëŒ€ì „ì§€ì‚¬">ë‚¨ëŒ€ì „ì§€ì‚¬</option>
                            <option value="ë¶ëŒ€ì „ì§€ì‚¬">ë¶ëŒ€ì „ì§€ì‚¬</option>
                            <option value="ëŒ€ì „ì˜ì—…íŒ€ì„¼í„°">ëŒ€ì „ì˜ì—…íŒ€ì„¼í„°</option>
                            <option value="ë‚¨ì–‘ì£¼ì§€ì‚¬">ë‚¨ì–‘ì£¼ì§€ì‚¬</option>
                            <option value="ìµì‚°ì§€ì‚¬">ìµì‚°ì§€ì‚¬</option>
                            <option value="ë©€í‹°ì»¤ë¨¸ìŠ¤">ë©€í‹°ì»¤ë¨¸ìŠ¤</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="morningOrder">ê°€ì˜¤ë” ìˆ˜ëŸ‰</label>
                        <input type="number" id="morningOrder" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="tempOrderTime">ê°€ì˜¤ë” ì‹œê°„</label>
                        <input type="time" id="tempOrderTime" value="09:00">
                    </div>
                    <div class="form-group">
                        <label for="confirmedOrder">í™•ì •ì˜¤ë” ìˆ˜ëŸ‰</label>
                        <input type="number" id="confirmedOrder" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmedOrderTime">í™•ì •ì˜¤ë” ì‹œê°„</label>
                        <input type="time" id="confirmedOrderTime" value="15:00">
                    </div>
                    <div class="form-group">
                        <label for="cancelled">ì·¨ì†Œëœ ì˜¤ë”</label>
                        <input type="number" id="cancelled" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="changed">ë³€ê²½ëœ ì˜¤ë”</label>
                        <input type="number" id="changed" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="added">ì¶”ê°€ëœ ì˜¤ë”</label>
                        <input type="number" id="added" min="0" value="0">
                    </div>
                </div>
                <div class="form-group" style="margin-top: 20px;">
                    <label for="memo">ìƒì„¸ ë©”ëª¨</label>
                    <textarea id="memo" rows="3" placeholder="ì¶”ê°€ì ì¸ ìƒí™©ì´ë‚˜ íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                <button type="submit" class="btn" style="margin-top: 20px;">ğŸ“Š ë°ì´í„° ì €ì¥</button>
            </form>
        </div>
        
        <div id="analysis" class="tab-content">
            <h2 style="margin-bottom: 25px; color: #1e3c72;">ğŸ“ˆ í†µê³„ ë¶„ì„</h2>
            
            <div class="filter-section">
                <div class="filter-group">
                    <label>ê¸°ê°„ ì„ íƒ:</label>
                    <select id="statsPeriod" onchange="toggleStatsFilters()">
                        <option value="all">ì „ì²´</option>
                        <option value="monthly">ì›”ë³„</option>
                        <option value="daily">ì¼ë³„</option>
                    </select>
                </div>
                <div class="filter-group" id="monthFilter" style="display: none;">
                    <label>ì›” ì„ íƒ:</label>
                    <input type="month" id="selectedMonth" onchange="updateStatistics()">
                </div>
                <div class="filter-group" id="dateFilter" style="display: none;">
                    <label>ë‚ ì§œ ì„ íƒ:</label>
                    <input type="date" id="selectedDate" onchange="updateStatistics()">
                </div>
                <div class="filter-group">
                    <label>ì§€ì‚¬ ì„ íƒ:</label>
                    <select id="statsBranch" onchange="updateStatistics()">
                        <option value="">ì „ì²´ ì§€ì‚¬</option>
                        <option value="ì²­ì£¼ì§€ì‚¬">ì²­ì£¼ì§€ì‚¬</option>
                        <option value="ì¶©ì£¼ì§€ì‚¬">ì¶©ì£¼ì§€ì‚¬</option>
                        <option value="ì²œì•ˆì§€ì‚¬">ì²œì•ˆì§€ì‚¬</option>
                        <option value="ì•„ì‚°ì§€ì‚¬">ì•„ì‚°ì§€ì‚¬</option>
                        <option value="ì„œì‚°ì§€ì‚¬">ì„œì‚°ì§€ì‚¬</option>
                        <option value="ì„¸ì¢…ì§€ì‚¬">ì„¸ì¢…ì§€ì‚¬</option>
                        <option value="ë‚¨ëŒ€ì „ì§€ì‚¬">ë‚¨ëŒ€ì „ì§€ì‚¬</option>
                        <option value="ë¶ëŒ€ì „ì§€ì‚¬">ë¶ëŒ€ì „ì§€ì‚¬</option>
                        <option value="ëŒ€ì „ì˜ì—…íŒ€ì„¼í„°">ëŒ€ì „ì˜ì—…íŒ€ì„¼í„°</option>
                        <option value="ë‚¨ì–‘ì£¼ì§€ì‚¬">ë‚¨ì–‘ì£¼ì§€ì‚¬</option>
                        <option value="ìµì‚°ì§€ì‚¬">ìµì‚°ì§€ì‚¬</option>
                        <option value="ë©€í‹°ì»¤ë¨¸ìŠ¤">ë©€í‹°ì»¤ë¨¸ìŠ¤</option>
                    </select>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="totalOrders">0</h3>
                    <p>ì´ í™•ì •ì˜¤ë” ìˆ˜</p>
                </div>
                <div class="stat-card">
                    <h3 id="avgAccuracy">0%</h3>
                    <p>í‰ê·  ì •í™•ë¥ </p>
                </div>
                <div class="stat-card">
                    <h3 id="totalCancelled">0</h3>
                    <p>ì´ ì·¨ì†Œ ìˆ˜</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalChanged">0</h3>
                    <p>ì´ ë³€ê²½ ìˆ˜</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalAdded">0</h3>
                    <p>ì´ ì¶”ê°€ ìˆ˜</p>
                </div>
            </div>
            
            <h3 style="margin: 30px 0 15px 0; color: #1e3c72;">ì§€ì‚¬ë³„ í†µê³„</h3>
            <table>
                <thead>
                    <tr>
                        <th>ì§€ì‚¬ëª…</th>
                        <th>ì´ í™•ì •ì˜¤ë”</th>
                        <th>ì •í™•ë¥ </th>
                        <th>ì·¨ì†Œìœ¨</th>
                        <th>ë³€ê²½ìœ¨</th>
                        <th>ì¶”ê°€ìœ¨</th>
                    </tr>
                </thead>
                <tbody id="branchStatsBody">
                </tbody>
            </table>
        </div>
        
        <div id="history" class="tab-content">
            <h2 style="margin-bottom: 25px; color: #1e3c72;">ğŸ“‹ ì…ë ¥ ì´ë ¥</h2>
            
            <div class="filter-section">
                <div class="filter-group">
                    <label>ê¸°ê°„ ì„ íƒ:</label>
                    <select id="historyPeriod" onchange="toggleHistoryFilters()">
                        <option value="all">ì „ì²´</option>
                        <option value="monthly">ì›”ë³„</option>
                        <option value="daily">ì¼ë³„</option>
                    </select>
                </div>
                <div class="filter-group" id="historyMonthFilter" style="display: none;">
                    <label>ì›” ì„ íƒ:</label>
                    <input type="month" id="historySelectedMonth" onchange="filterHistory()">
                </div>
                <div class="filter-group" id="historyDateFilter" style="display: none;">
                    <label>ë‚ ì§œ ì„ íƒ:</label>
                    <input type="date" id="historySelectedDate" onchange="filterHistory()">
                </div>
                <div class="filter-group">
                    <label>ì§€ì‚¬ ì„ íƒ:</label>
                    <select id="filterBranch" onchange="filterHistory()">
                        <option value="">ì „ì²´ ì§€ì‚¬</option>
                        <option value="ì²­ì£¼ì§€ì‚¬">ì²­ì£¼ì§€ì‚¬</option>
                        <option value="ì¶©ì£¼ì§€ì‚¬">ì¶©ì£¼ì§€ì‚¬</option>
                        <option value="ì²œì•ˆì§€ì‚¬">ì²œì•ˆì§€ì‚¬</option>
                        <option value="ì•„ì‚°ì§€ì‚¬">ì•„ì‚°ì§€ì‚¬</option>
                        <option value="ì„œì‚°ì§€ì‚¬">ì„œì‚°ì§€ì‚¬</option>
                        <option value="ì„¸ì¢…ì§€ì‚¬">ì„¸ì¢…ì§€ì‚¬</option>
                        <option value="ë‚¨ëŒ€ì „ì§€ì‚¬">ë‚¨ëŒ€ì „ì§€ì‚¬</option>
                        <option value="ë¶ëŒ€ì „ì§€ì‚¬">ë¶ëŒ€ì „ì§€ì‚¬</option>
                        <option value="ëŒ€ì „ì˜ì—…íŒ€ì„¼í„°">ëŒ€ì „ì˜ì—…íŒ€ì„¼í„°</option>
                        <option value="ë‚¨ì–‘ì£¼ì§€ì‚¬">ë‚¨ì–‘ì£¼ì§€ì‚¬</option>
                        <option value="ìµì‚°ì§€ì‚¬">ìµì‚°ì§€ì‚¬</option>
                        <option value="ë©€í‹°ì»¤ë¨¸ìŠ¤">ë©€í‹°ì»¤ë¨¸ìŠ¤</option>
                    </select>
                </div>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>ë‚ ì§œ</th>
                        <th>ì§€ì‚¬ëª…</th>
                        <th>ê°€ì˜¤ë”ìˆ˜ëŸ‰</th>
                        <th>ê°€ì˜¤ë”ì‹œê°„</th>
                        <th>í™•ì •ì˜¤ë”ìˆ˜ëŸ‰</th>
                        <th>í™•ì •ì˜¤ë”ì‹œê°„</th>
                        <th>ì·¨ì†Œ</th>
                        <th>ë³€ê²½</th>
                        <th>ì¶”ê°€</th>
                        <th>ì •í™•ë¥ </th>
                        <th>ë©”ëª¨</th>
                        <th>ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody id="historyBody">
                </tbody>
            </table>
            
            <div class="export-section">
                <h3 style="margin-bottom: 20px;">ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h3>
                <p style="margin-bottom: 20px;">ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ ë‹¤ì–‘í•œ í˜•íƒœë¡œ ë‚´ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                <button class="export-btn" onclick="exportToCSV()">CSV íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°</button>
                <button class="export-btn" onclick="exportToJSON()">JSON íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°</button>
                <button class="export-btn" onclick="printReport()">ë³´ê³ ì„œ ì¸ì‡„</button>
            </div>
        </div>
    </div>

    <script>
        let orderData = [];
        let editingIndex = -1;

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.className = isError ? 'status-message status-error' : 'status-message status-success';
            statusDiv.textContent = message;
            setTimeout(() => {
                statusDiv.textContent = '';
                statusDiv.className = '';
            }, 3000);
        }

        function saveData() {
            try {
                localStorage.setItem('orderData', JSON.stringify(orderData));
                return true;
            } catch (error) {
                console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                return false;
            }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem('orderData');
                if (savedData) {
                    orderData = JSON.parse(savedData);
                }
            } catch (error) {
                console.error('ë¡œë“œ ì˜¤ë¥˜:', error);
                orderData = [];
            }
        }

        function calculateAccuracy(morning, confirmed, cancelled, changed) {
            if (morning === 0) return 0;
            const added = confirmed > morning ? confirmed - morning : 0;
            const totalVariation = cancelled + changed + added;
            return Math.max(0, Math.min(100, Math.round(((morning - totalVariation) / morning) * 100)));
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'analysis') updateStatistics();
            if (tabName === 'history') updateHistory();
        }

        function toggleStatsFilters() {
            const period = document.getElementById('statsPeriod').value;
            const monthFilter = document.getElementById('monthFilter');
            const dateFilter = document.getElementById('dateFilter');
            
            if (period === 'monthly') {
                monthFilter.style.display = 'flex';
                dateFilter.style.display = 'none';
            } else if (period === 'daily') {
                monthFilter.style.display = 'none';
                dateFilter.style.display = 'flex';
            } else {
                monthFilter.style.display = 'none';
                dateFilter.style.display = 'none';
            }
            updateStatistics();
        }

        function toggleHistoryFilters() {
            const period = document.getElementById('historyPeriod').value;
            const monthFilter = document.getElementById('historyMonthFilter');
            const dateFilter = document.getElementById('historyDateFilter');
            
            if (period === 'monthly') {
                monthFilter.style.display = 'flex';
                dateFilter.style.display = 'none';
            } else if (period === 'daily') {
                monthFilter.style.display = 'none';
                dateFilter.style.display = 'flex';
            } else {
                monthFilter.style.display = 'none';
                dateFilter.style.display = 'none';
            }
            filterHistory();
        }

        function updateStatistics() {
            const period = document.getElementById('statsPeriod').value;
            const selectedMonth = document.getElementById('selectedMonth').value;
            const selectedDate = document.getElementById('selectedDate').value;
            const selectedBranch = document.getElementById('statsBranch').value;
            
            let filteredData = [...orderData];
            
            if (period === 'monthly' && selectedMonth) {
                filteredData = filteredData.filter(item => item.date.startsWith(selectedMonth));
            } else if (period === 'daily' && selectedDate) {
                filteredData = filteredData.filter(item => item.date === selectedDate);
            }
            
            if (selectedBranch) {
                filteredData = filteredData.filter(item => item.branch === selectedBranch);
            }
            
            if (filteredData.length === 0) {
                document.getElementById('totalOrders').textContent = '0';
                document.getElementById('avgAccuracy').textContent = '0%';
                document.getElementById('totalCancelled').textContent = '0';
                document.getElementById('totalChanged').textContent = '0';
                document.getElementById('totalAdded').textContent = '0';
                document.getElementById('branchStatsBody').innerHTML = '<tr><td colspan="6">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }
            
            const totalOrders = filteredData.reduce((sum, item) => sum + (item.confirmedOrder || 0), 0);
            const totalCancelled = filteredData.reduce((sum, item) => sum + (item.cancelled || 0), 0);
            const totalChanged = filteredData.reduce((sum, item) => sum + (item.changed || 0), 0);
            const totalAdded = filteredData.reduce((sum, item) => sum + (item.added || 0), 0);
            const avgAccuracy = Math.round(filteredData.reduce((sum, item) => sum + (item.accuracy || 0), 0) / filteredData.length);
            
            document.getElementById('totalOrders').textContent = totalOrders.toLocaleString();
            document.getElementById('avgAccuracy').textContent = avgAccuracy + '%';
            document.getElementById('totalCancelled').textContent = totalCancelled.toLocaleString();
            document.getElementById('totalChanged').textContent = totalChanged.toLocaleString();
            document.getElementById('totalAdded').textContent = totalAdded.toLocaleString();
            
            const branchStats = {};
            filteredData.forEach(item => {
                if (!branchStats[item.branch]) {
                    branchStats[item.branch] = {
                        totalOrders: 0, totalConfirmed: 0, totalCancelled: 0,
                        totalChanged: 0, totalAdded: 0, accuracySum: 0, count: 0
                    };
                }
                const stats = branchStats[item.branch];
                stats.totalOrders += (item.morningOrder || 0);
                stats.totalConfirmed += (item.confirmedOrder || 0);
                stats.totalCancelled += (item.cancelled || 0);
                stats.totalChanged += (item.changed || 0);
                stats.totalAdded += (item.added || 0);
                stats.accuracySum += (item.accuracy || 0);
                stats.count += 1;
            });
            
            const tbody = document.getElementById('branchStatsBody');
            tbody.innerHTML = '';
            
            Object.entries(branchStats).forEach(([branch, stats]) => {
                const avgAccuracy = Math.round(stats.accuracySum / stats.count);
                const cancelRate = stats.totalOrders > 0 ? Math.round((stats.totalCancelled / stats.totalOrders) * 100) : 0;
                const changeRate = stats.totalOrders > 0 ? Math.round((stats.totalChanged / stats.totalOrders) * 100) : 0;
                const addRate = stats.totalOrders > 0 ? Math.round((stats.totalAdded / stats.totalOrders) * 100) : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${branch}</strong></td>
                    <td>${stats.totalConfirmed.toLocaleString()}</td>
                    <td><span style="color: ${avgAccuracy >= 90 ? '#28a745' : avgAccuracy >= 70 ? '#ffc107' : '#dc3545'}">${avgAccuracy}%</span></td>
                    <td>${cancelRate}%</td>
                    <td>${changeRate}%</td>
                    <td>${addRate}%</td>
                `;
                tbody.appendChild(row);
            });
        }

        function filterHistory() {
            const period = document.getElementById('historyPeriod').value;
            const selectedMonth = document.getElementById('historySelectedMonth').value;
            const selectedDate = document.getElementById('historySelectedDate').value;
            const selectedBranch = document.getElementById('filterBranch').value;
            
            let filteredData = [...orderData];
            
            if (period === 'monthly' && selectedMonth) {
                filteredData = filteredData.filter(item => item.date.startsWith(selectedMonth));
            } else if (period === 'daily' && selectedDate) {
                filteredData = filteredData.filter(item => item.date === selectedDate);
            }
            
            if (selectedBranch) {
                filteredData = filteredData.filter(item => item.branch === selectedBranch);
            }
            
            const tbody = document.getElementById('historyBody');
            tbody.innerHTML = '';
            
            if (filteredData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="12">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }
            
            const sortedData = filteredData.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedData.forEach((item) => {
                const originalIndex = orderData.indexOf(item);
                const row = document.createElement('tr');
                row.setAttribute('data-index', originalIndex);
                row.innerHTML = `
                    <td>${item.date}</td>
                    <td>${item.branch}</td>
                    <td>${item.morningOrder}</td>
                    <td>${item.tempOrderTime || '-'}</td>
                    <td>${item.confirmedOrder}</td>
                    <td>${item.confirmedOrderTime || '-'}</td>
                    <td>${item.cancelled}</td>
                    <td>${item.changed}</td>
                    <td>${item.added}</td>
                    <td><span style="color: ${item.accuracy >= 90 ? '#28a745' : item.accuracy >= 70 ? '#ffc107' : '#dc3545'}">${item.accuracy}%</span></td>
                    <td style="max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${item.memo || ''}">${item.memo || '-'}</td>
                    <td>
                        <button class="edit-btn" onclick="startEdit(${originalIndex})">ìˆ˜ì •</button>
                        <button class="delete-btn" onclick="deleteRecord(${originalIndex})">ì‚­ì œ</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateHistory() {
            filterHistory();
        }

        function startEdit(index) {
            if (editingIndex !== -1) {
                alert('ë‹¤ë¥¸ í•­ëª©ì„ í¸ì§‘ ì¤‘ì…ë‹ˆë‹¤.');
                return;
            }
            
            editingIndex = index;
            const item = orderData[index];
            const row = document.querySelector(`tr[data-index="${index}"]`);
            
            if (!row) return;
            
            row.innerHTML = `
                <td><input type="date" value="${item.date}" class="edit-input-wide" id="edit-date-${index}"></td>
                <td>
                    <select class="edit-select" id="edit-branch-${index}">
                        <option value="ì²­ì£¼ì§€ì‚¬" ${item.branch === 'ì²­ì£¼ì§€ì‚¬' ? 'selected' : ''}>ì²­ì£¼ì§€ì‚¬</option>
                        <option value="ì¶©ì£¼ì§€ì‚¬" ${item.branch === 'ì¶©ì£¼ì§€ì‚¬' ? 'selected' : ''}>ì¶©ì£¼ì§€ì‚¬</option>
                        <option value="ì²œì•ˆì§€ì‚¬" ${item.branch === 'ì²œì•ˆì§€ì‚¬' ? 'selected' : ''}>ì²œì•ˆì§€ì‚¬</option>
                        <option value="ì•„ì‚°ì§€ì‚¬" ${item.branch === 'ì•„ì‚°ì§€ì‚¬' ? 'selected' : ''}>ì•„ì‚°ì§€ì‚¬</option>
                        <option value="ì„œì‚°ì§€ì‚¬" ${item.branch === 'ì„œì‚°ì§€ì‚¬' ? 'selected' : ''}>ì„œì‚°ì§€ì‚¬</option>
                        <option value="ì„¸ì¢…ì§€ì‚¬" ${item.branch === 'ì„¸ì¢…ì§€ì‚¬' ? 'selected' : ''}>ì„¸ì¢…ì§€ì‚¬</option>
                        <option value="ë‚¨ëŒ€ì „ì§€ì‚¬" ${item.branch === 'ë‚¨ëŒ€ì „ì§€ì‚¬' ? 'selected' : ''}>ë‚¨ëŒ€ì „ì§€ì‚¬</option>
                        <option value="ë¶ëŒ€ì „ì§€ì‚¬" ${item.branch === 'ë¶ëŒ€ì „ì§€ì‚¬' ? 'selected' : ''}>ë¶ëŒ€ì „ì§€ì‚¬</option>
                        <option value="ëŒ€ì „ì˜ì—…íŒ€ì„¼í„°" ${item.branch === 'ëŒ€ì „ì˜ì—…íŒ€ì„¼í„°' ? 'selected' : ''}>ëŒ€ì „ì˜ì—…íŒ€ì„¼í„°</option>
                        <option value="ë‚¨ì–‘ì£¼ì§€ì‚¬" ${item.branch === 'ë‚¨ì–‘ì£¼ì§€ì‚¬' ? 'selected' : ''}>ë‚¨ì–‘ì£¼ì§€ì‚¬</option>
                        <option value="ìµì‚°ì§€ì‚¬" ${item.branch === 'ìµì‚°ì§€ì‚¬' ? 'selected' : ''}>ìµì‚°ì§€ì‚¬</option>
                        <option value="ë©€í‹°ì»¤ë¨¸ìŠ¤" ${item.branch === 'ë©€í‹°ì»¤ë¨¸ìŠ¤' ? 'selected' : ''}>ë©€í‹°ì»¤ë¨¸ìŠ¤</option>
                    </select>
                </td>
                <td><input type="number" value="${item.morningOrder}" min="0" class="edit-input" id="edit-morning-${index}"></td>
                <td><input type="time" value="${item.tempOrderTime || ''}" class="edit-input" id="edit-temptime-${index}"></td>
                <td><input type="number" value="${item.confirmedOrder}" min="0" class="edit-input" id="edit-confirmed-${index}"></td>
                <td><input type="time" value="${item.confirmedOrderTime || ''}" class="edit-input" id="edit-confirmedtime-${index}"></td>
                <td><input type="number" value="${item.cancelled}" min="0" class="edit-input" id="edit-cancelled-${index}"></td>
                <td><input type="number" value="${item.changed}" min="0" class="edit-input" id="edit-changed-${index}"></td>
                <td><input type="number" value="${item.added}" min="0" class="edit-input" id="edit-added-${index}"></td>
                <td>${item.accuracy}%</td>
                <td><textarea class="edit-input-memo" id="edit-memo-${index}">${item.memo || ''}</textarea></td>
                <td>
                    <button class="save-btn" onclick="saveEdit(${index})">ì €ì¥</button>
                    <button class="cancel-btn" onclick="cancelEdit(${index})">ì·¨ì†Œ</button>
                </td>
            `;
        }

        function saveEdit(index) {
            const newDate = document.getElementById(`edit-date-${index}`).value;
            const newBranch = document.getElementById(`edit-branch-${index}`).value;
            const newMorning = parseInt(document.getElementById(`edit-morning-${index}`).value) || 0;
            const newConfirmed = parseInt(document.getElementById(`edit-confirmed-${index}`).value) || 0;
            const newCancelled = parseInt(document.getElementById(`edit-cancelled-${index}`).value) || 0;
            const newChanged = parseInt(document.getElementById(`edit-changed-${index}`).value) || 0;
            const newAdded = parseInt(document.getElementById(`edit-added-${index}`).value) || 0;
            const newTempTime = document.getElementById(`edit-temptime-${index}`).value;
            const newConfirmedTime = document.getElementById(`edit-confirmedtime-${index}`).value;
            const newMemo = document.getElementById(`edit-memo-${index}`).value;
            
            if (!newDate || !newBranch) {
                alert('ë‚ ì§œì™€ ì§€ì‚¬ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
                return;
            }
            
            const existingIndex = orderData.findIndex((item, idx) => 
                idx !== index && item.date === newDate && item.branch === newBranch
            );
            
            if (existingIndex !== -1) {
                alert('í•´ë‹¹ ë‚ ì§œì™€ ì§€ì‚¬ì˜ ë°ì´í„°ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.');
                return;
            }
            
            const autoAdded = Math.max(0, newConfirmed - newMorning);
            const finalAdded = Math.max(newAdded, autoAdded);
            const newAccuracy = calculateAccuracy(newMorning, newConfirmed, newCancelled, newChanged);
            
            orderData[index] = {
                ...orderData[index],
                date: newDate,
                branch: newBranch,
                morningOrder: newMorning,
                confirmedOrder: newConfirmed,
                cancelled: newCancelled,
                changed: newChanged,
                added: finalAdded,
                tempOrderTime: newTempTime,
                confirmedOrderTime: newConfirmedTime,
                memo: newMemo,
                accuracy: newAccuracy
            };
            
            if (saveData()) {
                editingIndex = -1;
                filterHistory();
                updateStatistics();
                showStatus('ë°ì´í„°ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        function cancelEdit(index) {
            editingIndex = -1;
            filterHistory();
        }

        function deleteRecord(index) {
            if (editingIndex !== -1) {
                alert('í¸ì§‘ ì¤‘ì¸ í•­ëª©ì´ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                orderData.splice(index, 1);
                if (saveData()) {
                    updateHistory();
                    updateStatistics();
                    showStatus('ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        function exportToCSV() {
            if (orderData.length === 0) {
                alert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            let csv = 'ë‚ ì§œ,ì§€ì‚¬ëª…,ê°€ì˜¤ë”ìˆ˜ëŸ‰,ê°€ì˜¤ë”ì‹œê°„,í™•ì •ì˜¤ë”ìˆ˜ëŸ‰,í™•ì •ì˜¤ë”ì‹œê°„,ì·¨ì†Œ,ë³€ê²½,ì¶”ê°€,ì •í™•ë¥ ,ë©”ëª¨\n';
            orderData.forEach(item => {
                csv += `${item.date},${item.branch},${item.morningOrder},${item.tempOrderTime || ''},${item.confirmedOrder},${item.confirmedOrderTime || ''},${item.cancelled},${item.changed},${item.added},${item.accuracy}%,${item.memo || ''}\n`;
            });
            
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ë°°ì°¨ì˜¤ë”_ë¶„ì„_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function exportToJSON() {
            if (orderData.length === 0) {
                alert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const blob = new Blob([JSON.stringify(orderData, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ë°°ì°¨ì˜¤ë”_ë°ì´í„°_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        function printReport() {
            window.print();
        }

        // í¼ ì œì¶œ ì²˜ë¦¬
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            
            const today = new Date().toISOString().split('T')[0];
            const currentMonth = new Date().toISOString().slice(0, 7);
            
            document.getElementById('date').value = today;
            document.getElementById('selectedMonth').value = currentMonth;
            document.getElementById('selectedDate').value = today;
            document.getElementById('historySelectedMonth').value = currentMonth;
            document.getElementById('historySelectedDate').value = today;
            
            document.getElementById('orderForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const dateValue = document.getElementById('date').value;
                const branchValue = document.getElementById('branch').value;
                const morningOrderValue = document.getElementById('morningOrder').value;
                const confirmedOrderValue = document.getElementById('confirmedOrder').value;
                const cancelledValue = document.getElementById('cancelled').value;
                const changedValue = document.getElementById('changed').value;
                const addedValue = document.getElementById('added').value;
                const tempOrderTimeValue = document.getElementById('tempOrderTime').value;
                const confirmedOrderTimeValue = document.getElementById('confirmedOrderTime').value;
                const memoValue = document.getElementById('memo').value;
                
                if (!dateValue || !branchValue || !morningOrderValue || !confirmedOrderValue) {
                    showStatus('ë‚ ì§œ, ì§€ì‚¬ëª…, ê°€ì˜¤ë” ìˆ˜ëŸ‰, í™•ì •ì˜¤ë” ìˆ˜ëŸ‰ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.', true);
                    return;
                }
                
                const morningOrder = parseInt(morningOrderValue) || 0;
                const confirmedOrder = parseInt(confirmedOrderValue) || 0;
                const cancelled = parseInt(cancelledValue) || 0;
                const changed = parseInt(changedValue) || 0;
                const added = parseInt(addedValue) || 0;
                
                const autoAdded = Math.max(0, confirmedOrder - morningOrder);
                const finalAdded = Math.max(added, autoAdded);
                
                const formData = {
                    date: dateValue,
                    branch: branchValue,
                    morningOrder: morningOrder,
                    confirmedOrder: confirmedOrder,
                    cancelled: cancelled,
                    changed: changed,
                    added: finalAdded,
                    tempOrderTime: tempOrderTimeValue,
                    confirmedOrderTime: confirmedOrderTimeValue,
                    memo: memoValue,
                    accuracy: calculateAccuracy(morningOrder, confirmedOrder, cancelled, changed)
                };
                
                const existingIndex = orderData.findIndex(item => 
                    item.date === formData.date && item.branch === formData.branch
                );
                
                if (existingIndex !== -1) {
                    if (confirm('í•´ë‹¹ ë‚ ì§œì™€ ì§€ì‚¬ì˜ ë°ì´í„°ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤. ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        orderData[existingIndex] = formData;
                    } else {
                        return;
                    }
                } else {
                    orderData.push(formData);
                }
                
                if (saveData()) {
                    showStatus('ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    this.reset();
                    document.getElementById('date').value = today;
                    document.getElementById('tempOrderTime').value = '09:00';
                    document.getElementById('confirmedOrderTime').value = '15:00';
                    updateStatistics();
                } else {
                    showStatus('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', true);
                }
            });
            
            updateStatistics();
            updateHistory();
        });
    </script>
</body>
</html>
                    
